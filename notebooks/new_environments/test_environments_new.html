<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Import simulation output &mdash; Vivarium E. coli 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Vivarium E. coli
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference/processes.html">Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/composites.html">Composites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/experiments.html">Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs.html">Working with Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/stores.html">Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/api_ref.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vivarium E. coli</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Import simulation output</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/new_environments/test_environments_new.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/vivarium-ecoli&#39;</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">dill</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">xmltodict</span>
<span class="kn">from</span> <span class="nn">ecoli.processes.metabolism_redux</span> <span class="kn">import</span> <span class="n">NetworkFlowModel</span><span class="p">,</span> <span class="n">FlowResult</span><span class="p">,</span> <span class="n">MetabolismRedux</span>

<span class="n">FREE_RXNS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TRANS-RXN-145&quot;</span><span class="p">,</span> <span class="s2">&quot;TRANS-RXN0-545&quot;</span><span class="p">,</span> <span class="s2">&quot;TRANS-RXN0-474&quot;</span><span class="p">]</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;darkgrid&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;talk&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<section id="Import-simulation-output">
<h1>Import simulation output<a class="headerlink" href="#Import-simulation-output" title="Link to this heading"></a></h1>
<p>Before running this, I ran a sim in ecoli/experiments/metabolism_redux_sim.py with -n 2 to generate a simulation output. This is necessary to replicate the simulation environment, where we e.g. have dynamic demand for amino acids and nucleotides, and varying cell volumes.</p>
<p>You don’t have to do this for now. We’ll use a single time step from the simulation output to test the network flow model on its own.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time</span> <span class="o">=</span> <span class="s1">&#39;50&#39;</span>
<span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;2023-06-09&#39;</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="s1">&#39;fba-redux&#39;</span>
<span class="n">entry</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">time</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;out/fbagd/</span><span class="si">{</span><span class="n">entry</span><span class="si">}</span><span class="s1">/&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;output.npy&#39;</span><span class="p">,</span><span class="n">allow_pickle</span><span class="o">=</span><span class="s1">&#39;TRUE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="c1"># output = np.load(r&quot;out/geneRxnVerifData/output_glc.npy&quot;, allow_pickle=True, encoding=&#39;ASCII&#39;).tolist()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;agents&#39;</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">]</span>
<span class="n">fba</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;listeners&#39;</span><span class="p">][</span><span class="s1">&#39;fba_results&#39;</span><span class="p">]</span>
<span class="n">mass</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;listeners&#39;</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">]</span>
<span class="n">bulk</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;bulk&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is the model itself - we&#39;ll pull e.g. stoichiometry from here.</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;agent_steps.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">agent</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">metabolism</span> <span class="o">=</span> <span class="n">agent</span><span class="p">[</span><span class="s1">&#39;ecoli-metabolism-redux&#39;</span><span class="p">]</span>
<span class="n">stoichiometry</span> <span class="o">=</span> <span class="n">metabolism</span><span class="o">.</span><span class="n">stoichiometry</span>
</pre></div>
</div>
</div>
</section>
<section id="Check-molecule-exchanges-from-simulation---sanity-check.">
<h1>Check molecule exchanges from simulation - sanity check.<a class="headerlink" href="#Check-molecule-exchanges-from-simulation---sanity-check." title="Link to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_exchanges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fba</span><span class="p">[</span><span class="s2">&quot;estimated_exchange_dmdt&quot;</span><span class="p">])</span>
<span class="n">sim_exchanges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sim_exchanges</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># plot the top 10 fluxes from sim_fluxes as a bar plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_exchanges</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># shorten all xtick names to 10 characters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span> <span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sim_exchanges</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">20</span><span class="p">]],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="c1"># make xticks aligned to right left of bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 10 Fluxes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_new_environments_test_environments_new_6_0.png" src="../../_images/notebooks_new_environments_test_environments_new_6_0.png" />
</div>
</div>
</section>
<section id="Check-reaction-fluxes-from-simulation---sanity-check.">
<h1>Check reaction fluxes from simulation - sanity check.<a class="headerlink" href="#Check-reaction-fluxes-from-simulation---sanity-check." title="Link to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_fluxes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fba</span><span class="p">[</span><span class="s2">&quot;estimated_fluxes&quot;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">metabolism</span><span class="o">.</span><span class="n">reaction_names</span><span class="p">)</span>
<span class="n">sim_fluxes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sim_fluxes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>


<span class="c1"># plot the top 10 fluxes from sim_fluxes as a bar plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_fluxes</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># shorten all xtick names to 10 characters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span> <span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sim_fluxes</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">20</span><span class="p">]],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="c1"># make xticks aligned to right left of bar</span>


<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux counts&#39;</span><span class="p">)</span>
<span class="c1"># log scale</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 10 Fluxes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_new_environments_test_environments_new_8_0.png" src="../../_images/notebooks_new_environments_test_environments_new_8_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_catalysts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fba</span><span class="p">[</span><span class="s2">&quot;reaction_catalyst_counts&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">reaction_names</span><span class="p">)</span>
<span class="n">sim_catalysts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sim_catalysts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">sim_catalysts</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>RXN0-1741-MALTOSE//MALTOSE.17.</th>
      <td>24833.0</td>
    </tr>
    <tr>
      <th>RXN0-0-CPD0-1123//N-ACETYLNEURAMINATE.31.</th>
      <td>24807.0</td>
    </tr>
    <tr>
      <th>RXN-15315</th>
      <td>24807.0</td>
    </tr>
    <tr>
      <th>RXN0-0-CPD0-1122//CPD0-1122.21.</th>
      <td>24807.0</td>
    </tr>
    <tr>
      <th>RXN0-0-CPD0-1122//N-ACETYLNEURAMINATE.31.</th>
      <td>24807.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>BETAGALACTOSID-RXN-Alpha-lactose/WATER//GALACTOSE/GLC.35.</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>BETAGALACTOSID-RXN-Alpha-lactose/WATER//GALACTOSE/Glucopyranose.45.</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>BETAGALACTOSID-RXN-CPD-15972/WATER//GALACTOSE/ALPHA-GLUCOSE.41.</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>BETAGALACTOSID-RXN-CPD-15972/WATER//GALACTOSE/GLC.31.</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>RXN0-963</th>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>7504 rows × 1 columns</p>
</div></div>
</div>
</section>
<section id="Test-changing-nutrient-composition">
<h1>Test changing nutrient composition<a class="headerlink" href="#Test-changing-nutrient-composition" title="Link to this heading"></a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uptake</span> <span class="o">=</span> <span class="n">metabolism</span><span class="o">.</span><span class="n">allowed_exchange_uptake</span>
<span class="n">uptake</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">uptake</span><span class="p">)</span>

<span class="c1"># addition = set([&quot;CPD0-1074[c]&quot;])</span>
<span class="n">addition</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
        <span class="c1"># &quot;FRU[p]&quot;,</span>
        <span class="c1"># &quot;NITRATE[p]&quot;</span>
        <span class="c1"># &#39;THIAMINE[p]&#39;,</span>
        <span class="c1"># &#39;HYDROGEN-MOLECULE[p]&#39;,</span>
        <span class="c1"># &#39;FUM[p]&#39;</span>
<span class="p">])</span>
<span class="n">removals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span>
                  <span class="c1"># &quot;GLC[p]&quot;,</span>
               <span class="c1">#      # &#39;AMMONIUM[c]&#39;,</span>
               <span class="c1">#      # &#39;WATER[p]&#39;</span>
               <span class="c1">#       # &#39;Pi[p]&#39;,</span>
               <span class="c1">#       # &#39;SULFATE[p]&#39;</span>
               <span class="c1"># &#39;OXYGEN-MOLECULE[p]&#39;</span>
<span class="p">])</span>


<span class="n">uptake</span> <span class="o">=</span> <span class="n">uptake</span> <span class="o">|</span> <span class="n">addition</span>
<span class="n">uptake</span> <span class="o">=</span> <span class="n">uptake</span> <span class="o">-</span> <span class="n">removals</span>
<span class="n">uptake</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;AMMONIUM[c]&#39;,
 &#39;CA+2[p]&#39;,
 &#39;CARBON-DIOXIDE[p]&#39;,
 &#39;CL-[p]&#39;,
 &#39;CO+2[p]&#39;,
 &#39;FE+2[p]&#39;,
 &#39;GLC[p]&#39;,
 &#39;K+[p]&#39;,
 &#39;L-SELENOCYSTEINE[c]&#39;,
 &#39;MG+2[p]&#39;,
 &#39;MN+2[p]&#39;,
 &#39;NA+[p]&#39;,
 &#39;NI+2[p]&#39;,
 &#39;OXYGEN-MOLECULE[p]&#39;,
 &#39;Pi[p]&#39;,
 &#39;SULFATE[p]&#39;,
 &#39;WATER[p]&#39;,
 &#39;ZN+2[p]&#39;}
</pre></div></div>
</div>
</section>
<section id="Use-NetworkFlowModel-class-to-run-model">
<h1>Use NetworkFlowModel class to run model<a class="headerlink" href="#Use-NetworkFlowModel-class-to-run-model" title="Link to this heading"></a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">homeostatic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fba</span><span class="p">[</span><span class="s2">&quot;target_homeostatic_dmdt&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">homeostatic_metabolites</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">maintenance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fba</span><span class="p">[</span><span class="s2">&quot;maintenance_target&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;maintenance_reaction&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">kinetic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fba</span><span class="p">[</span><span class="s2">&quot;target_kinetic_fluxes&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">kinetic_constraint_reactions</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">NetworkFlowModel</span><span class="p">(</span>
            <span class="n">stoich_arr</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">stoichiometry</span><span class="p">,</span>
            <span class="n">metabolites</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">metabolite_names</span><span class="p">,</span>
            <span class="n">reactions</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">reaction_names</span><span class="p">,</span>
            <span class="n">homeostatic_metabolites</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">homeostatic</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">kinetic_reactions</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kinetic</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">free_reactions</span><span class="o">=</span><span class="n">FREE_RXNS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">set_up_exchanges</span><span class="p">(</span><span class="n">exchanges</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">exchange_molecules</span><span class="p">,</span> <span class="n">uptakes</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">allowed_exchange_uptake</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">objective_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;secretion&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;efficiency&#39;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="s1">&#39;kinetics&#39;</span><span class="p">:</span> <span class="mf">0.000001</span><span class="p">}</span>
<span class="n">solution</span><span class="p">:</span> <span class="n">FlowResult</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
            <span class="n">homeostatic_targets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">homeostatic</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
            <span class="n">maintenance_target</span><span class="o">=</span><span class="n">maintenance</span><span class="p">,</span>
            <span class="n">kinetic_targets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kinetic</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
            <span class="n">binary_kinetic_idx</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">objective_weights</span><span class="o">=</span><span class="n">objective_weights</span><span class="p">,</span>
            <span class="n">upper_flux_bound</span><span class="o">=</span><span class="mi">100000000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">exchanges</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5182    8.249992e+06
639     2.490931e+06
4382    2.221422e+06
3617    1.074952e+06
446     9.069960e+05
            ...
1775    0.000000e+00
1774    0.000000e+00
1773    0.000000e+00
1772    0.000000e+00
5313    0.000000e+00
Length: 5314, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur_exchanges</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">exchanges</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">metabolite_names</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_exchanges</span><span class="p">[</span><span class="n">cur_exchanges</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># plot the top 10 fluxes from sim_fluxes as a bar plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cur_exchanges</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">nonzero</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># shorten all xtick names to 10 characters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nonzero</span><span class="p">)],</span> <span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cur_exchanges</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">nonzero</span><span class="p">]],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="c1"># make xticks aligned to right left of bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 10 Fluxes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_new_environments_test_environments_new_18_0.png" src="../../_images/notebooks_new_environments_test_environments_new_18_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cur_fluxes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">velocities</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">reaction_names</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># plot the top 10 fluxes from sim_fluxes as a bar plot.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cur_fluxes</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="c1"># shorten all xtick names to 10 characters</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)],</span> <span class="p">[</span><span class="n">i</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cur_fluxes</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">20</span><span class="p">]],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="c1"># make xticks aligned to right left of bar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Top 10 Fluxes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_new_environments_test_environments_new_19_0.png" src="../../_images/notebooks_new_environments_test_environments_new_19_0.png" />
</div>
</div>
<section id="Connect-to-EcoCyc-to-go-from-Genes--&gt;-Reactions">
<h2>Connect to EcoCyc to go from Genes -&gt; Reactions<a class="headerlink" href="#Connect-to-EcoCyc-to-go-from-Genes-->-Reactions" title="Link to this heading"></a></h2>
<p>We use the EcoCyc API to automatically figure out what are made possible by the genes we are adding. While reactions are always possible, enzymes make them faster to the point that it is useful to the cell.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="c1"># create session</span>
<span class="c1"># Post login credentials to session:</span>
<span class="n">s</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://websvc.biocyc.org/credentials/login/&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;email&#39;</span><span class="p">:</span><span class="s1">&#39;cellulararchitect@protonmail.com&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span><span class="s1">&#39;Cellman0451&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Response [200]&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition_sets</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Environment&quot;</span><span class="p">:</span> <span class="s2">&quot;Hydrogen + fumarate, -O2, -Glc&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Genes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;EG10468&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10469&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10470&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11799&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11800&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11801&quot;</span><span class="p">,</span> <span class="s2">&quot;G7554&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;FUM[p]&quot;</span><span class="p">,</span> <span class="s1">&#39;HYDROGEN-MOLECULE[p]&#39;</span><span class="p">},</span>
                      <span class="s2">&quot;Remove&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;GLC[p]&quot;</span><span class="p">,</span> <span class="s2">&quot;OXYGEN-MOLECULE[p]&quot;</span><span class="p">},</span>
                      <span class="p">},</span>

                  <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Environment&quot;</span><span class="p">:</span> <span class="s2">&quot;Ribose C-source&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Genes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;EG10814&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10815&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10816&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10818&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;D-Ribopyranose[p]&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Remove&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;GLC[p]&quot;</span><span class="p">},</span>
                      <span class="p">},</span>

                  <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Environment&quot;</span><span class="p">:</span> <span class="s2">&quot;Thiamine salvaging&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Genes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;EG11574&quot;</span><span class="p">,</span> <span class="s2">&quot;G6566&quot;</span><span class="p">,</span> <span class="s2">&quot;M007&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11573&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11572&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;THIAMINE[p]&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Remove&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                      <span class="p">},</span>

                  <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Environment&quot;</span><span class="p">:</span> <span class="s2">&quot;Nitrate as reduction target&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Genes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;EG10638&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10639&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10640&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10644&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10647&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10648&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;NITRATE[p]&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Remove&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;OXYGEN-MOLECULE[p]&quot;</span><span class="p">},</span>
                      <span class="p">},</span>

                  <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Environment&quot;</span><span class="p">:</span> <span class="s2">&quot;3-Phenylpropionate as carbon and energy source&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Genes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;M010&quot;</span><span class="p">,</span> <span class="s2">&quot;M011&quot;</span><span class="p">,</span> <span class="s2">&quot;M012&quot;</span><span class="p">,</span> <span class="s2">&quot;G6206&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;3-PHENYLPROPIONATE[p]&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Remove&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;GLC[p]&quot;</span><span class="p">},</span>
                      <span class="p">},</span>

                  <span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Environment&quot;</span><span class="p">:</span> <span class="s2">&quot;Molybdenum cofactor synthesis&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Genes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;EG11595&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11666&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11597&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11598&quot;</span><span class="p">,</span> <span class="s2">&quot;EG11829&quot;</span><span class="p">,</span> <span class="s2">&quot;G7496&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10002&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10152&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;EG10153&quot;</span><span class="p">,</span> <span class="s2">&quot;EG10154&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Add&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;CPD-3[p]&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Remove&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                      <span class="s2">&quot;Demand&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;CPD-8123[c]&quot;</span><span class="p">},</span>
                      <span class="p">},</span>

                  <span class="mi">6</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Environment&quot;</span><span class="p">:</span> <span class="s2">&quot;pre-Quenosine synthesis&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;Genes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;G6245&quot;</span><span class="p">,</span> <span class="s2">&quot;G7431&quot;</span><span class="p">,</span> <span class="s2">&quot;G7452&quot;</span><span class="p">},</span>
                      <span class="s2">&quot;Add&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                      <span class="s2">&quot;Remove&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
                      <span class="s2">&quot;Demand&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;7-AMINOMETHYL-7-DEAZAGUANINE[c]&quot;</span><span class="p">},</span>
                      <span class="p">},</span>



                  <span class="c1"># 5: {&quot;Genes&quot;: set([&quot;EG10286&quot;, &quot;EG10287&quot;, &quot;EG10288&quot;, &quot;EG10289&quot;,</span>
                  <span class="c1">#                   &quot;EG10290&quot;, &quot;EG10293&quot;, &quot;EG10294&quot;, &quot;EG10295&quot;,</span>
                  <span class="c1">#                   &quot;EG10296&quot;, &quot;EG10298&quot;, &quot;EG10302&quot;, &quot;EG10303&quot;,</span>
                  <span class="c1">#                   &quot;EG10304&quot;, &quot;EG10305&quot;, &quot;EG10306&quot;, &quot;G6414&quot;]),</span>
                  <span class="c1">#     &quot;Add&quot;: set(),</span>
                  <span class="c1">#     &quot;Remove&quot;: set(),</span>
                  <span class="c1">#     &quot;Environment&quot;: &quot;Proper metal (iron) uptake&quot;}</span>
                 <span class="p">}</span>

<span class="n">condition_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">condition_sets</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">condition_df</span><span class="p">[</span><span class="s2">&quot;Reactions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">condition_df</span><span class="p">)</span>
<span class="n">condition_df</span><span class="p">[</span><span class="s2">&quot;Demand&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">condition_df</span><span class="p">[</span><span class="s2">&quot;Demand&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">condition_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Environment</th>
      <th>Genes</th>
      <th>Add</th>
      <th>Remove</th>
      <th>Demand</th>
      <th>Reactions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Hydrogen + fumarate, -O2, -Glc</td>
      <td>{G7554, EG11799, EG10469, EG11800, EG10470, EG...</td>
      <td>{HYDROGEN-MOLECULE[p], FUM[p]}</td>
      <td>{OXYGEN-MOLECULE[p], GLC[p]}</td>
      <td>False</td>
      <td>[nan]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ribose C-source</td>
      <td>{EG10818, EG10814, EG10815, EG10816}</td>
      <td>{D-Ribopyranose[p]}</td>
      <td>{GLC[p]}</td>
      <td>False</td>
      <td>[nan]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Thiamine salvaging</td>
      <td>{G6566, M007, EG11572, EG11573, EG11574}</td>
      <td>{THIAMINE[p]}</td>
      <td>{}</td>
      <td>False</td>
      <td>[nan]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Nitrate as reduction target</td>
      <td>{EG10638, EG10648, EG10640, EG10647, EG10639, ...</td>
      <td>{NITRATE[p]}</td>
      <td>{OXYGEN-MOLECULE[p]}</td>
      <td>False</td>
      <td>[nan]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3-Phenylpropionate as carbon and energy source</td>
      <td>{M010, M011, M012, G6206}</td>
      <td>{3-PHENYLPROPIONATE[p]}</td>
      <td>{GLC[p]}</td>
      <td>False</td>
      <td>[nan]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>{EG10152, G7496, EG11597, EG11829, EG10153, EG...</td>
      <td>{CPD-3[p]}</td>
      <td>{}</td>
      <td>{CPD-8123[c]}</td>
      <td>[nan]</td>
    </tr>
    <tr>
      <th>6</th>
      <td>pre-Quenosine synthesis</td>
      <td>{G6245, G7452, G7431}</td>
      <td>{}</td>
      <td>{}</td>
      <td>{7-AMINOMETHYL-7-DEAZAGUANINE[c]}</td>
      <td>[nan]</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">condition_df</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>

    <span class="n">genes</span> <span class="o">=</span> <span class="n">condition_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Genes&quot;</span><span class="p">]</span>
    <span class="n">rxn_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">genes</span><span class="p">:</span>
        <span class="n">function</span> <span class="o">=</span> <span class="s2">&quot;reactions-of-gene&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gene</span>
        <span class="n">req_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://websvc.biocyc.org/apixml?fn=</span><span class="si">{</span><span class="n">function</span><span class="si">}</span><span class="s2">&amp;id=ECOLI:</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&amp;detail=none&amp;fmt=json&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">req_str</span><span class="p">)</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">&#39;ptools-xml&#39;</span><span class="p">][</span><span class="s1">&#39;Reaction&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">o</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rxn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="c1"># no rxns</span>
                <span class="n">rxn_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rxn</span><span class="p">[</span><span class="s1">&#39;@frameid&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">gene</span><span class="p">,</span> <span class="n">rxn</span><span class="p">)</span>

    <span class="n">condition_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Reactions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxn_set</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Environment</th>
      <th>Genes</th>
      <th>Add</th>
      <th>Remove</th>
      <th>Demand</th>
      <th>Reactions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Hydrogen + fumarate, -O2, -Glc</td>
      <td>{G7554, EG11799, EG10469, EG11800, EG10470, EG...</td>
      <td>{HYDROGEN-MOLECULE[p], FUM[p]}</td>
      <td>{OXYGEN-MOLECULE[p], GLC[p]}</td>
      <td>False</td>
      <td>{RXN-16420, RXN0-5256, RXN0-7399}</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ribose C-source</td>
      <td>{EG10818, EG10814, EG10815, EG10816}</td>
      <td>{D-Ribopyranose[p]}</td>
      <td>{GLC[p]}</td>
      <td>False</td>
      <td>{RIBOKIN-RXN, ABC-28-RXN}</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Thiamine salvaging</td>
      <td>{G6566, M007, EG11572, EG11573, EG11574}</td>
      <td>{THIAMINE[p]}</td>
      <td>{}</td>
      <td>False</td>
      <td>{RXN0-7298, ABC-32-RXN, THIKIN-RXN, THIAZOLSYN...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Nitrate as reduction target</td>
      <td>{EG10638, EG10648, EG10640, EG10647, EG10639, ...</td>
      <td>{NITRATE[p]}</td>
      <td>{OXYGEN-MOLECULE[p]}</td>
      <td>False</td>
      <td>{RXN0-7124, RXN-15119, RXN0-3501}</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3-Phenylpropionate as carbon and energy source</td>
      <td>{M010, M011, M012, G6206}</td>
      <td>{3-PHENYLPROPIONATE[p]}</td>
      <td>{GLC[p]}</td>
      <td>False</td>
      <td>{1.13.11.16-RXN, RXN-10040, MHPHYDROXY-RXN, TR...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>{EG10152, G7496, EG11597, EG11829, EG10153, EG...</td>
      <td>{CPD-3[p]}</td>
      <td>{}</td>
      <td>{CPD-8123[c]}</td>
      <td>{RXN-21601, RXN-17809, RXN0-262, RXN-8342, RXN...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>pre-Quenosine synthesis</td>
      <td>{G6245, G7452, G7431}</td>
      <td>{}</td>
      <td>{}</td>
      <td>{7-AMINOMETHYL-7-DEAZAGUANINE[c]}</td>
      <td>{RXN0-4022, RXN0-5507, RXN-12093}</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Quick-and-dirty-loop-(after-init)">
<h2>Quick and dirty loop (after init)<a class="headerlink" href="#Quick-and-dirty-loop-(after-init)" title="Link to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Environment&quot;</span><span class="p">,</span> <span class="s2">&quot;Reaction&quot;</span><span class="p">,</span> <span class="s2">&quot;Flux&quot;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">condition_df</span><span class="p">)):</span>
    <span class="n">condition_idx</span> <span class="o">=</span> <span class="n">i</span>

    <span class="n">uptake</span> <span class="o">=</span> <span class="n">metabolism</span><span class="o">.</span><span class="n">allowed_exchange_uptake</span>

    <span class="n">homeostatic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">fba</span><span class="p">[</span><span class="s2">&quot;target_homeostatic_dmdt&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">homeostatic_metabolites</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">new_demand</span> <span class="o">=</span> <span class="n">condition_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">condition_idx</span><span class="p">,</span> <span class="s2">&quot;Demand&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">new_demand</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">met</span> <span class="ow">in</span> <span class="n">new_demand</span><span class="p">:</span>
            <span class="n">homeostatic</span><span class="p">[</span><span class="n">met</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">uptake</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">uptake</span><span class="p">)</span>

    <span class="n">addition</span> <span class="o">=</span> <span class="n">condition_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">condition_idx</span><span class="p">,</span> <span class="s2">&quot;Add&quot;</span><span class="p">]</span>
    <span class="n">removals</span> <span class="o">=</span> <span class="n">condition_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">condition_idx</span><span class="p">,</span> <span class="s2">&quot;Remove&quot;</span><span class="p">]</span>

    <span class="n">uptake</span> <span class="o">=</span> <span class="n">uptake</span> <span class="o">|</span> <span class="n">addition</span>
    <span class="n">uptake</span> <span class="o">=</span> <span class="n">uptake</span> <span class="o">-</span> <span class="n">removals</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">NetworkFlowModel</span><span class="p">(</span>
            <span class="n">stoich_arr</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">stoichiometry</span><span class="p">,</span>
            <span class="n">metabolites</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">metabolite_names</span><span class="p">,</span>
            <span class="n">reactions</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">reaction_names</span><span class="p">,</span>
            <span class="n">homeostatic_metabolites</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">homeostatic</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">kinetic_reactions</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kinetic</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">free_reactions</span><span class="o">=</span><span class="n">FREE_RXNS</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">set_up_exchanges</span><span class="p">(</span><span class="n">exchanges</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">exchange_molecules</span><span class="p">,</span> <span class="n">uptakes</span><span class="o">=</span><span class="n">uptake</span><span class="p">)</span>


    <span class="n">objective_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;secretion&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;efficiency&#39;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="s1">&#39;kinetics&#39;</span><span class="p">:</span> <span class="mf">0.000001</span><span class="p">}</span>
    <span class="n">solution</span><span class="p">:</span> <span class="n">FlowResult</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span>
                <span class="n">homeostatic_targets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">homeostatic</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
                <span class="n">maintenance_target</span><span class="o">=</span><span class="n">maintenance</span><span class="p">,</span>
                <span class="n">kinetic_targets</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kinetic</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">())),</span>
                <span class="n">binary_kinetic_idx</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">objective_weights</span><span class="o">=</span><span class="n">objective_weights</span><span class="p">,</span>
                <span class="n">upper_flux_bound</span><span class="o">=</span><span class="mi">100000000</span><span class="p">)</span>

    <span class="c1"># Check flux</span>
    <span class="n">fluxes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">velocities</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">metabolism</span><span class="o">.</span><span class="n">reaction_names</span><span class="p">)</span>
    <span class="c1"># fluxes = pd.DataFrame({model.rxns[i]: [solution.velocities[model.rxns[i]]] for i in range(len(model.rxns))}).T</span>
    <span class="n">fluxes</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Flux&quot;</span><span class="p">]</span>

    <span class="n">relevant_rxns</span> <span class="o">=</span> <span class="n">condition_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">condition_idx</span><span class="p">,</span> <span class="s2">&quot;Reactions&quot;</span><span class="p">]</span>
    <span class="n">relevant_rxn_idx</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">relevant_rxns</span><span class="p">:</span>
        <span class="n">relevant_rxn_idx</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fluxes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">rxn</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="p">))</span>

    <span class="n">relevant_fluxes</span> <span class="o">=</span> <span class="n">fluxes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">relevant_rxn_idx</span><span class="p">]</span>

    <span class="n">relevant_nonzero_fluxes</span> <span class="o">=</span> <span class="n">relevant_fluxes</span><span class="p">[</span><span class="n">relevant_fluxes</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">relevant_nonzero_fluxes</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
        <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">condition_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">condition_idx</span><span class="p">,</span> <span class="s2">&quot;Environment&quot;</span><span class="p">],</span>
                          <span class="n">relevant_nonzero_fluxes</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                          <span class="n">relevant_nonzero_fluxes</span><span class="p">[</span><span class="n">k</span><span class="p">]]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Environment&quot;</span><span class="p">,</span> <span class="s2">&quot;Reaction&quot;</span><span class="p">,</span> <span class="s2">&quot;Flux&quot;</span><span class="p">]))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;finished </span><span class="si">{</span><span class="n">condition_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">condition_idx</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Environment&quot;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
finished Hydrogen + fumarate, -O2, -Glc
finished Ribose C-source
finished Thiamine salvaging
finished Nitrate as reduction target
finished 3-Phenylpropionate as carbon and energy source
finished Molybdenum cofactor synthesis
finished pre-Quenosine synthesis
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;Reaction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;Reaction&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;log(Flux)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">results_df</span><span class="p">[</span><span class="s2">&quot;Flux&quot;</span><span class="p">])</span>
<span class="n">results_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Environment</th>
      <th>Reaction</th>
      <th>Flux</th>
      <th>log(Flux)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Hydrogen + fumarate, -O2, -Glc</td>
      <td>RXN0-5256-CPD-9728/P</td>
      <td>2.073151e+07</td>
      <td>7.316631</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Ribose C-source</td>
      <td>RIBOKIN-RXN-CPD0-110</td>
      <td>9.177517e+05</td>
      <td>5.962725</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Ribose C-source</td>
      <td>RIBOKIN-RXN-CPD0-110</td>
      <td>4.346074e+05</td>
      <td>5.638097</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Ribose C-source</td>
      <td>ABC-28-RXN-ATP/D-Rib</td>
      <td>1.352359e+06</td>
      <td>6.131092</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Thiamine salvaging</td>
      <td>ABC-32-RXN</td>
      <td>2.900000e+01</td>
      <td>1.462398</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Thiamine salvaging</td>
      <td>THIKIN-RXN</td>
      <td>2.900000e+01</td>
      <td>1.462398</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Nitrate as reduction target</td>
      <td>RXN0-7124-NITRATE/CP</td>
      <td>1.756030e+05</td>
      <td>5.244532</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Nitrate as reduction target</td>
      <td>RXN0-3501-NITRATE/RE</td>
      <td>1.300256e+06</td>
      <td>6.114029</td>
    </tr>
    <tr>
      <th>0</th>
      <td>3-Phenylpropionate as carbon and energy source</td>
      <td>1.13.11.16-RXN</td>
      <td>7.993023e+05</td>
      <td>5.902711</td>
    </tr>
    <tr>
      <th>0</th>
      <td>3-Phenylpropionate as carbon and energy source</td>
      <td>MHPCHYDROL-RXN</td>
      <td>7.993023e+05</td>
      <td>5.902711</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>RXN-17809</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>RXN-8342</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>RXN-8348</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>RXN-11361</td>
      <td>2.000000e+02</td>
      <td>2.301030</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>RXN-8340</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Molybdenum cofactor synthesis</td>
      <td>ABC-19-RXN</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>pre-Quenosine synthesis</td>
      <td>RXN0-4022 (reverse)</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>pre-Quenosine synthesis</td>
      <td>RXN0-5507</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>0</th>
      <td>pre-Quenosine synthesis</td>
      <td>RXN-12093</td>
      <td>1.000000e+02</td>
      <td>2.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for each environment, plot the fluxes of the reactions that are relevant to that environment</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;Environment&quot;</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Reaction&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log(Flux)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">results_df</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;notebooks/fbagd/figures/rxns_light_up.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_new_environments_test_environments_new_28_0.png" src="../../_images/notebooks_new_environments_test_environments_new_28_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2024, The Vivarium E. coli Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>